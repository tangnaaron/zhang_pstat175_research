---
title: "Kaggle Shopping Data Exploration"
date: "2026-02-01"
format: 
  pdf
html-math-method: mathjax
execute:
  eval: TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(ggplot2)
library(here)
library(corrplot)
library(gridExtra)
library(ggridges)
```

## Background About Data:

LINK: https://www.kaggle.com/datasets/rabieelkharoua/predict-customer-purchase-behavior-dataset

data from where, collected how? , year? , purpose?

## Import Data

```{r}
# Use here() to make it dynamic
raw_shopping <- read_csv(here("shopping", "data", "raw_data","kaggle_shopping.csv"))
raw_shopping
```

### Change Categorical Variables to Factors

```{r}
shopping <- raw_shopping |>
  mutate(across(c(Gender, ProductCategory, LoyaltyProgram, PurchaseStatus), as.factor))

summary(shopping)
```

Notes:

-   Age Range: \[18, 70\]

-   Gender: almost 50/50; average 750 customers (no gender bias)

-   Income: \[\$20,002 , \$149,785\]; average \$84,249 (slightly right skewed, higher earners high impact)

-   NumPurchases: \[0, 20\]

-   ProductCategory: average 300 (pretty balanced)

-   TimeSpent: \[1, 60); average is 30 minutes (decent engagement)

-   Loyalty: \~33% enrolled

-   Discounts: \[1,5\]; average 3 (slightly left skewed, customers will little/no usage pull down average)

-   PurchaseStatus: \~43% purchase

### Histograms of the Continuous Variables

```{r}
## Histogram of continuous variables 
continuous_var <- c("Age", "AnnualIncome", "NumberOfPurchases", "TimeSpentOnWebsite", "DiscountsAvailed")

# set up a 2 x 3 grid to display all histograms together 
par(mfrow = c(2, 3))

for (i in 1:length(continuous_var)) {
  current = shopping[[continuous_var[i]]] # get rows of that variable
  hist(current,
       xlab = continuous_var[i], 
       main = paste("Histogram of", continuous_var[i]),
       col = "lightblue",
       freq = FALSE)
  lines(density(current, adjust = 2), col = "black", lwd = 2) # visualize shape of distribution
  # note: adjust > 1 will smooth out the line (adjust < 1 will hug the data more)
}

# reset back to default 
par(mfrow = c(1, 1))

```

Takeaway: The shopping data has a very even distribution for all variables. Since our data is very balanced, this can prevent bias and over-fitting of a particular dominant class.

### Boxplots - Distribution of Variables based on Purchase Status

```{r}

## Box plots 
time <- ggplot(data = shopping, mapping = aes(x = PurchaseStatus, y = TimeSpentOnWebsite)) +
  geom_boxplot()

income <- ggplot(data = shopping, mapping = aes(x = PurchaseStatus, y = AnnualIncome)) +
  geom_boxplot()

age <- ggplot(data = shopping, mapping = aes(x = PurchaseStatus, y = Age)) +
  geom_boxplot()

discount <- ggplot(data = shopping, mapping = aes(x = PurchaseStatus, y = DiscountsAvailed)) +
  geom_boxplot()

# showcase all boxplots using gridExtra library
grid.arrange(time, income, age, discount, ncol = 2)

```

```{r}
## Frequency tables
prop.table(table(shopping$LoyaltyProgram, shopping$PurchaseStatus))
```

### Gender on Purchase Status

```{r}
gender_x_purchase <- shopping |>
  group_by(Gender) |>
  summarise(
    TotalPurchases = sum(NumberOfPurchases),
    AveragePurchases = mean(NumberOfPurchases),
    AverageTimeSpent = mean(TimeSpentOnWebsite),
    Purchase_Prob = sum(as.integer(PurchaseStatus))/n())
gender_x_purchase 

```

### Checking Purchase Status with Number Of Purchases?

Question: If PurchaseStatus is 0, why is there a nonempty NumberOfPurchases category for those rows?

-   NumberOfPurchases is historical, which PurchaseStatus is the most current.

```{r}
# Scatter plot between time spent and number of purchases
summary <- shopping %>%
  group_by(PurchaseStatus, NumberOfPurchases) %>%
  summarize(mean_time = mean(TimeSpentOnWebsite))

ggplot(data = summary, mapping = aes(x = NumberOfPurchases, y = mean_time,
                                      fill = PurchaseStatus)) +
  geom_density(stat = 'identity', alpha = 0.5)
```

Notes: - It appears that the longer the mean time spent on a website, the greater the likelihood someone is to purchase something - Time spent on website seems to be relatively uniform across number of purchases

### Age on Time Spent

```{r}
shopping_with_age_group <- shopping %>%
  mutate(AgeGroup = case_when(
    between(Age, 18, 25) ~ "[18, 25]",
    between(Age, 26, 35) ~ "[26, 35]",
    between(Age, 36, 45) ~ "[36, 45]",
    between(Age, 46, 55) ~ "[46, 55]",
    between(Age, 56, 65) ~ "[56, 65]",
    between(Age, 66, 70) ~ "[66, 70]"
  ))

shopping_with_age_group$AgeGroup <- factor(shopping_with_age_group$AgeGroup,
                                           level = c("[18, 25]",
                                                     "[26, 35]",
                                                     "[36, 45]",
                                                     "[46, 55]",
                                                     "[56, 65]",
                                                     "[66, 70]"),
                                           ordered = TRUE)

summary <- shopping_with_age_group %>%
  group_by(PurchaseStatus, AgeGroup) %>%
  summarize(mean_time = mean(TimeSpentOnWebsite),
            n = n())

ggplot(data = summary, mapping = aes(x = AgeGroup, y = mean_time,
                                     fill = PurchaseStatus)) +
  geom_bar(stat = 'identity', position = 'dodge')
```

### Age on PurchaseStatus

```{r}
ggplot(data = summary, mapping = aes(x = AgeGroup, y = n,
                                     fill = PurchaseStatus)) +
  geom_bar(stat = 'identity', position = 'dodge') 

```
